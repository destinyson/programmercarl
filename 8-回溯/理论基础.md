# 回溯理论基础

## 回溯的概念

- 回溯法：也可以叫做回溯搜索法，是一种搜索的方式
- 回溯的本质是穷举，穷举所有可能，然后选出我们想要的答案，如果想让回溯法高效一些，可以加一些剪枝的操作，但也改不了回溯法就是穷举的本质。
- 由此可见，回溯法并不高效。之所以使用这种方法，因为没得选，一些问题能暴力搜出来就不错了，撑死了再剪枝一下，还没有更高效的解法

## 回溯适用范围
- 回溯法，一般可以解决如下几种问题：
  - 组合问题：N个数里面按一定规则找出k个数的集合
  - 切割问题：一个字符串按一定规则有几种切割方式
  - 子集问题：一个N个数的集合里有多少符合条件的子集
  - 排列问题：N个数按一定规则全排列，有几种排列方式
  - 棋盘问题：N皇后，解数独等等

## 关于回溯的理解
- 所有回溯法解决的问题，都可以抽象为树形结构
- 因为回溯法解决的都是在集合中递归查找子集，集合的大小就构成了树的宽度；递归的深度，就构成的树的深度
- 递归就要有终止条件，所以必然是一棵高度有限的树（N叉树）

## 回溯的模板
- 模板如下：
```
// 注意此处回溯函数的返回值，会根据具体问题的类别有所变化，下面例题中会有介绍
void backtracking(参数) {
    if (终止条件) {
        存放结果;
        return;
    }

    for (选择：本层集合中元素（树中节点孩子的数量就是集合的大小）) {
        处理节点;
        backtracking(路径，选择列表); // 递归
        回溯，撤销处理结果
    }
}
```

## 经典题目与技巧

- 把回溯问题抽象为树形结构，可以直观的看出其搜索的过程：
  - for循环横向遍历，递归纵向遍历，回溯不断调整结果集
  - 这个理念贯穿整个回溯法系列
- 优化回溯算法只有剪枝一种方法
- 剪枝精髓是：for循环在寻找起点的时候要有一个范围，如果这个起点开始已经不再符合题目要求，就没有必要搜索了
- 回溯函数的返回值：
  - 如果需要遍历整棵树，通常返回值类型为void
  - 如果只需要获取一条路径就停止，通常返回值类型为bool
- 通常，回溯算法的复杂度，都是指数级别的时间复杂度

### 组合问题
- 组合问题中，回溯的作用是：用递归控制for循环嵌套的数量
- 注意去重的情况：
  - 结合回溯对应的树可以看出，去重为树层去重，即横向去重
  - 如果题目要求去重，由于组合问题通常不要求结果顺序，因此可以在对序列排序后，利用下标去重
- 对应问题：
  - [77-组合](例题/77-组合.md)
  - [216-组合总和III](例题/216-组合总和III.md)
  - [17-电话号码的字母组合](例题/17-电话号码的字母组合.md)
  - [39-组合总和](例题/39-组合总和.md)
  - [40-组合总和II](例题/40-组合总和II.md)

### 切割问题
- 切割问题其实可以利用组合问题的类似思路解决，不过要注意切割线的模拟、回溯终止条件、以及子序列的截取
- 对应问题：
  - [131-分割回文串](例题/131-分割回文串.md)
  - [93-复原IP地址](例题/93-复原IP地址.md)

### 子集问题
- 子集问题与组合问题的最大区别是：从树的角度来看，子集问题需要收集所有节点，而组合问题只需要收集叶子节点
- 对应问题：
  - [78-子集](例题/78-子集.md)
  - [90-子集II](例题/90-子集II.md)
  - [491-递增子序列](例题/491-递增子序列.md)

### 排列问题
- 由于排列与组合对元素顺序的要求不同，因此排列问题的去重不能使用下标了。通常，使用一个used数组标记进行去重
- 题目“重新安排行程”本质上是图论中的深度优先遍历，但深度优先遍历与回溯通常是分不开的，加之本题是求欧拉路径，其实就是自带部分要求的排列问题，因此此处放入排列问题
- 对应问题：
  - [46-全排列](例题/46-全排列.md)
  - [47-全排列II](例题/47-全排列II.md)
  - [332-重新安排行程](例题/332-重新安排行程.md)

### 棋盘问题
- 棋盘问题是回溯问题中较难的问题，但核心还是仔细研究，搞清单层递归逻辑与递归终止条件，只要搞清这两点基本就没什么难度了
- 对应问题：
  - [51-N皇后](例题/51-N皇后.md)
  - [37-解数独](例题/37-解数独.md)